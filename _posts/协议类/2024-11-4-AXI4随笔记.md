---
layout: post
title: AMBA AXI随笔记
date: 2024-11-04 20:23 +0800
categories: [spec文档阅读, protocol]
tags: []
math: true
img_path: /assets/img/axi/
---

<script> var password = prompt("请输入密码："); if (password !== "xiaokai") {document.body.innerHTML = "访问被拒绝。"; } </script>


## Outstanding Transfer
**不需要等待前一笔传输完成就可以发送下一笔操作**

![outstanding]({{ page.img_path }}outstanding.png){: width="972" height="589" }
![outstanding_n3]({{ page.img_path }}outstanding_n3.png){: width="972" height="589" }
![outstanding_n4]({{ page.img_path }}outstanding_n4.png){: width="972" height="589" }

合理选择好outstanding的深度可以达到最大的带宽（tradeoff），最佳深度的范围在：$\frac{一次transaction传输所需要的时间}{数据传输需要的时间}$

Take a SoC for example:

- Suppose BUS@500MHz (period=2ns)
- Suppose AXI command is burst 8 (ideal: need 8 cycle to transfer)
- The latency is 200ns

Outstanding Num =200/ (2ns*8) =8~16

## Out-of-order Transfer
针对于多个从机，返回的response可以不按master访问的顺序。举个例子，master先向slave0发了读请求然后向slave1发了读请求。由于从机速度可能不一样，支持出现<font color="#d99694">先返回slave1的数据然后返回slave0的数据</font>

![Out-of-order]({{ page.img_path }}Out-of-order.png){: width="972" height="589" }

这里的bubble就可以先返回CD

排序规则：
- 所有的transfers in a trapsaction有相同的 ID，<font color="#d99694">相同的ID的传输顺序must be ordered as issued</font>
- Slaves generally need a configurable ID width
- 
 

### Interleaving Transfer
<font color="#d99694">写Interleaving已经在AXI4中移除了</font>

读Interleaving是**在乱序（Out-of-order Transfer）的基础上支持不同ID间数据之间的乱序**

![interleaving]({{ page.img_path }}interleaving.png){: width="972" height="589" }




## 附录-信号释意
- AxPROT[2:0] ：给CPU用的，AxPROT[0]特权模式；AxPROT[1]Non-secure；AxPROT[2] Instruction
- AxCACHE[3:0]： [WA:RA:C/M:B]  write/read allocate；Cacheable(AXI3)/Modifiable(AXI4)；Bufferable    （Modifiable：The burst and transfer characteristics can change between source and destination）
- AxLOCK：normal和exclusive
	- locked access：Blocks（阻止） access from all other masters to the slave.（<font color="#d99694">AXI4取消了</font>）
	- exclusive access：阻止其他对memory region in the slave的访问
	- The exclusive access mechanism enables the implementation of semaphore type operations without requiring the bus to remain locked to a particular master for the duration of the operation.
	- semaphore：Requires slave hardware support.Exclusive Access Monitor.对share的region进行lock
	- exclusive：先进行读某个地址空间的地址，获取lock之后可以写，写成功会清除lock
- AxQOS：[3:0]，Encoding of 0xF is highest priority 可以用作arbiters和slave对访问的顺序进行调整
- AxREGION：[3:0]，Usage Models：
	- 可以借助master的信号来区分访问memory的哪一块region，简化slave对地址的译码操作
	- slave可以限制不同区域的访问等行为
- AXI3升级到AXI4
	- 从之前的16长度的burst support (up to 256 beats. i.e.AxLEN is 0-255)
	- 去除了write data interleaving和LOCK
- AXI-Lite：和AXI4的区别
	- All accesses are Non-modifiable, Non-bufferable，不支持Exclusive
	- data bus必须为32 or 64 的full width，且burst length为1
- 